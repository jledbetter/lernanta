{% load l10n_tags %}
{% if tasks_count or show_all %}
  <div id="task_list_section">
    {% if is_challenge and participating and tasks_count %}

    <div id="congratulations-msg" class="help-request tasks-completed-msg {% if progressbar_value != 100 %}off{% endif %}">
      <h3>{{ _('Congratulations!') }}</h3>
      <p>{{ _('Good job completing all the tasks.') }}</p>
      {% if not organizing and not adopter %}
        <h4>{{ _('What to help?') }}</h4>
        <p>{{ _('You\'ve now unlocked the ability to help others by adopting this challenge.') }}</p>
        <form method="post" action="{% locale_url direct_signup_adopter slug=project.slug %}">
          {% csrf_token %}
          <button class="adopt-button">{{ _('Adopt this Challenge') }}</button>
        </form>
      {% endif %}
    </div>

      <div id="progress">
        <div id="progressbar" value="{{ progressbar_value }}"></div>
        <p><span id="completed_count">{{ completed_count }}</span>/<span id="total_count">{{ tasks_count }}</span> {{ _('Completed') }}</p>
      </div>
    {% endif %}
    <h2 class="school_header">{% if not is_challenge %}<span>{% endif %}{{ _('Tasks') }}{% if not is_challenge %}</span>{% endif %}</h2>
    {% if tasks_count %}
      <ul>
        {% for task in tasks %}
          <li class="{% cycle 'odd' 'even' %} {% if task.is_done %}taskSelected{% endif %}">
            {% if is_challenge and participating %}
              <form method='post' action='{% locale_url toggle_task_completion slug=task.project.slug page_slug=task.slug %}'>
                {% csrf_token %}
                <input class="taskCheckbox" type="checkbox" {% if task.is_done %}checked="checked"{% endif%}>
              </form>
            {% endif %}
            <span class="taskNumber">{{ forloop.counter }}{% if is_challenge %}.{% endif %}</span> <a class="taskLink" href="{{ task.get_absolute_url }}">{{ task.title }}</a>
            {% if organizing and show_all and is_challenge %}
	            {% if not forloop.first %}<a class="robttn up" href="{% locale_url page_index_up slug=project.slug counter=forloop.counter0 %}">(UP)</a>{% endif %}
	            {% if not forloop.last %}<a class="robttn dwn" href="{% locale_url page_index_down slug=project.slug counter=forloop.counter0 %}">(DOWN)</a>{% endif %}
            {% endif %}
            {% if is_challenge %}
                <a class="taskView" href="{{ task.get_absolute_url }}">{{ _('View and Discuss') }}</a>
                <span class="taskSubheader">{{ task.sub_header|default:"&nbsp;" }}</span>
            {% else %}
              <span class="action-buttons"><a href="{{ task.get_absolute_url }}">{{ _('View') }}</a></span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <br>{{ _('No tasks have been added.') }}<br><br>
    {% endif %}
    {% if visible_count < tasks_count %}
      <p id="more_task_link">
        <span id="task-count">{{ _('Displaying') }} {{ visible_count }} {{ _('of') }} {{ tasks_count }} {{ _('total tasks') }}</span>
        <a href="{% locale_url projects_task_list slug=project.slug %}">{{ _('See All Tasks') }} &raquo;</a>
      </p>
    {% endif %}
  </div>
{% endif %}
